---
title: 无缝发布：我的 Obsidian 到 Hugo 自动化同步流
date: 2026-01-07T10:00:00+08:00
draft: false
tags:
  - Obsidian
  - Hugo
  - Docker
categories:
  - 分享
---

作为一名长期使用 **Obsidian** 记录生活和技术的用户，我也同时是静态博客 **Hugo** 的拥趸。但长久以来，最大的痛点在于如何把这两者优雅地连接起来。

我不希望每次发布文章都要手动复制文件、处理图片路径、调整 Front Matter。我理想中的流是：**在 Obsidian 里按下 Ctrl+S，本地的 Hugo 预览就能实时更新，确认无误后一个 Git Push 完成发布。**

经过一番折腾，我终于基于 CouchDB 和自己编写的一个同步脚本，打通了这套全链路。

## 架构概览

我的整套发布流涉及以下几个核心节点：

1.  **写作端**：Obsidian (配合 Self-hosted Livesync 插件)
2.  **数据中转**：CouchDB (运行在 Docker 中)
3.  **同步核心**：**自研提取脚本 (运行在 Docker 中)**
4.  **生成端**：本地 Hugo 环境
5.  **图床方案**：Lsky Pro + Cloudflare R2



### 核心流程

1.  **Obsidian 写作**：我在 Obsidian 中修改笔记。
2.  **实时同步**：`Obsidian Livesync` 插件将变更实时推送到我的私有 `CouchDB` 数据库。
3.  **自动提取**：我的**同步脚本**监听数据库变动，解析数据，还原为标准的 `.md` 文件写入 Hugo 的 `content` 目录。
4.  **本地调试**：本地运行的 `hugo server` 检测到文件变动，实时刷新浏览器预览。
5.  **发布**：确认无误后，Git Commit & Push，触发 CI/CD 或直接推送到服务器。

---

## 关于图片的处理：图床方案

在静态博客中，图片管理一直是个麻烦事。如果把图片和 Markdown 混在一起同步，仓库体积会迅速膨胀，且路径处理极其繁琐。

我的解决方案是**完全剥离图片存储**：

* **存储后端**：使用 **Cloudflare R2**，免费额度大且速度快。
* **管理前端**：自建 **Lsky Pro** 图床。
* **上传插件**：在 Obsidian 中安装 **Image To Lskypro** 插件。

**效果**：当我在 Obsidian 中粘贴图片时，插件自动将其上传至 R2，并返回标准的 Markdown 图片链接（如 `![] (https://img.mydomain.com/...)`）。

因此，存入 CouchDB 和同步到本地的 Markdown 文件中，只包含纯文本链接，干净清爽。

---

## 缺失的一环：从 CouchDB 到 Markdown

Obsidian Livesync 插件非常强大，实现了多端实时同步。但它为了效率，将数据以 JSON/Blob 的形式存在 CouchDB 里，并不是直接存储为文件系统中的 `.md` 文件。

为了把数据库里的“碎片”还原成 Hugo 能识别的博客文章，我需要一个“翻译官”。

### 自研同步脚本 (Obsidian-Sync-Script)

我在 Docker 容器中跑了一个 Python 脚本，充当了这个桥梁。

它主要做了这几件事：

- **⏱️ 定时轮询**：脚本会以设定的时间间隔（例如每 20 秒）去询问 CouchDB 是否有新变动。虽然不是毫秒级实时，但作为博客发布流，这种**准实时**的节奏既节省资源，又能保证写完几口咖啡的时间里内容就已同步。
- **📂 目录还原**：完美保留 Obsidian 中的文件夹层级结构（例如 `/Blog/Tech/Docker.md`）。
- **🧹 自动清理**：如果在 Obsidian 里删除了文章或移动了文件夹，脚本会自动同步删除或移动本地文件，保持目录整洁。
- **🛡️ 智能过滤**：我设置了 `TARGET_FOLDER` 变量，只同步 `Blog` 文件夹下的内容，Obsidian 里的其他私有笔记绝不会泄露到博客目录

### 开源与使用

为了方便维护和部署，我将这个脚本封装成了 Docker 镜像。如果你也在使用 Obsidian Livesync + CouchDB 方案，并且想实现类似的自动化导出功能，可以直接使用我的镜像。

**Github 项目地址：**

👉 **[Obsidian-CouchDB-Sync-Script](https://github.com/KuroIVeko/obsidian-sync-script)**

*(具体的 Docker Compose 配置和环境变量说明，请移步 GitHub 仓库的 README 查看)*

---

## 结语

折腾工具的最终目的是为了忘记工具。

现在，无论是用电脑还是手机，只要我在 Obsidian 的 `Blog` 目录下新建一篇笔记，它就会自动出现在我的 Hugo 目录中。这种无感知的写作体验，让写博客重新变成了一件纯粹快乐的事情。
